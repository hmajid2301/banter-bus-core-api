asyncapi: 2.2.0
info:
  title: Banter Bus Core API
  version: 1.0.0
  description: |
    The Web Socket API definition for the Banter Bus application.

    ### Supported Games

     * [Fibbing It](https://gitlab.com/banter-bus/banter-bus-server/-/wikis/docs/rules/fibbing_it)
servers:
  production:
    url: wss://core.api.banterbus.games/ws
    protocol: wss
    description: Main API broker
defaultContentType: application/json
channels:
  /:
    publish:
      message:
        oneOf:
          - $ref: "#/components/messages/create_room"
          - $ref: "#/components/messages/join_room"
    subscribe:
      message:
        oneOf:
          - $ref: "#/components/messages/room_created"
components:
  messages:
    create_room:
      summary: Create a new game room.
      description: >-
        Client can create a new game room.
      payload:
        $ref: "#/components/schemas/create_room"
      x-response:
        $ref: "#/components/messages/room_created"
    room_created:
      summary: Room created is a response to `create_room` message.
      description: >-
        Server responds to `create_room` message. Which includes unique room URL and unique room code for other clients
        to join the room.
      payload:
        $ref: "#/components/schemas/new_room"
    join_room:
      summary: When a player has joined a game room.
      description: >-
        Client can create a new game room.
      payload:
        $ref: "#/components/schemas/join_room"
      x-response:
        $ref: "#/components/messages/room_joined"
  schemas:
    create_room:
      type: object
      properties:
        game_name:
          type: string
          description: Name of the game to create the room for, will fail if game is not enabled
      required:
        - game_name
    new_room:
      type: object
      properties:
        room_code:
          type: string
          description: Unique code to join the room.
          example: ABCDE
      required:
        - room_code
    join_room:
      type: object
      properties:
        avatar:
          type: string
          format: byte
          description: Binary representation of the player avatar.
        nickname:
          type: string
          description: The nickname of the player joining the room
          example: Majiy
        room_code:
          type: string
          description: The unqiue code of the room to join.
          example: ABCDE
      required:
        - avatar
        - nickname
        - room_code
    room_joined:
      type: object
      properties:
        nickname:
          type: string
          description: The nickname of the player joining the room
          example: Majiy
        avatar:
          type: string
          format: byte
          description: Binary representation of the player avatar.
        is_host:
          type: boolean
          description: If the player is the host or not
      required:
        - nickname
        - avatar
        - is_host
